<div class="grid-wrapper grid h-screen bg-black grid-cols-7 grid-rows-2">
  <div class="interface m-0.5 row-span-2 col-span-2 flex flex-col justify-between overflow-y-auto" [formGroup]="formGroup">
    <div class="flex flex-col">
      <div class="flex">
        <div class="flex flex-col w-4/6 ml-3">
          <ng-template
            [ngTemplateOutlet]="rangeBitsTmplRef"
            [ngTemplateOutletContext]="{ description: 'red', className: 'red', formControl: formGroup.get('r') }"
          ></ng-template>
          <ng-template
            [ngTemplateOutlet]="rangeBitsTmplRef"
            [ngTemplateOutletContext]="{ description: 'green', className: 'green', formControl: formGroup.get('g') }"
          ></ng-template>
          <ng-template
            [ngTemplateOutlet]="rangeBitsTmplRef"
            [ngTemplateOutletContext]="{ description: 'blue', className: 'blue', formControl: formGroup.get('b') }"
          ></ng-template>
        </div>
        <div class="flex flex-col items-center justify-center ml-5">
          <div class="font-semibold text-center uppercase">
            available space:
            <div class="font-medium text-2xl">{{ availableSpaceFormatted }}</div>
          </div>
        </div>
      </div>
      <div>
        <app-pixel-difference [pixels]="{ main: mainPixel?.color, secondary: encryptedPixel?.color }"></app-pixel-difference>
      </div>
      <div class="mt-4">
        <div class="font-semibold uppercase text-center">files size: <div class="font-medium text-2xl">{{ totalFileSizeFormatted }}</div></div>
        <app-files-list (filesChange)="updateUploadFiles($event)"></app-files-list>
      </div>
    </div>
    <div class="flex flex-col">
      <div class="uppercase text-green m-4" *ngIf="spaceLeft >= 0; else spaceNotEnoughTmplRef">
        space left: <span class="text-xl text-black font-semibold">{{ spaceLeftFormatted }}</span>
      </div>
      <ng-template #spaceNotEnoughTmplRef>
        <div class="uppercase text-red m-4">exceeded space</div>
      </ng-template>
      <div class="p-1">
        <button
          (click)="encodeIntoImage()"
          class="focus:outline-none w-full h-16 text-white text-xl py-2.5 px-5 rounded bg-blue-700 hover:bg-blue-600 hover:shadow-lg"
        >
          ENCODE
        </button>
      </div>
      <div *ngIf="position" class="flex border justify-end p-2 text-lg">
        <div class="mr-3">X: <span class="font-semibold">{{ position.x }}</span></div>
        <div>Y: <span class="font-semibold">{{ position.y }}</span></div>
      </div>
    </div>
  </div>

  <div class="col-span-5 canvas">
    <app-canvas-wrapper
      [enableFileDrop]="true"
      (fileDropped)="updateImage($event)"
      #mainCanvas
      [image]="image"
      [viewState]="viewState"
      (viewStateChange)="updateViewState($event)"
      (positionHoverChange)="updatePosition($event)"
    >
    </app-canvas-wrapper>
  </div>
  <div class="col-span-5 canvas">
    <app-canvas-wrapper
      #secondaryCanvas
      [image]="image"
      [viewState]="viewState"
      (viewStateChange)="updateViewState($event)"
      (positionHoverChange)="updatePosition($event)"
    >
    </app-canvas-wrapper>
  </div>
</div>

<ng-template
  #rangeBitsTmplRef
  let-description="description"
  let-formControl="formControl"
  let-className="className"
>
  <div class="flex justify-between font-semibold relative top-1.5">
    <label [for]="description" class="uppercase" [ngClass]="[description, className]">{{ description }}</label>
    <div class="flex">
      <div>0 - {{ rangeBits[formControl?.value] }}</div>
      <div class="ml-5">{{ formControl?.value }} bits</div>
    </div>
  </div>
  <input [formControl]="formControl" type="range" [id]="description" min="0" max="8">
</ng-template>
